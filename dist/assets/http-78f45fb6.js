import{a as p}from"./axios-c47e0cf1.js";import{c as f,l as r,d as s}from"./layout-4b72ee2f.js";import{r as i}from"./router-325b049e.js";import{u as l}from"./user-a1f28023.js";import{c as d}from"./vuex-3133efbc.js";import h from"./500-07d896ca.js";import _ from"./404-cdb51896.js";import{_ as v}from"./Lottie-739291b6.js";import{n,o as T,Y as A,P as k,O as x,I as u,s as o}from"./@vue-fa1c5c1f.js";import{G as R}from"./naive-ui-24262aab.js";const a=d({state:{isAlertedToken:!1,isAlertedTooManyRequests:!1}}),g={__name:"401",setup(e){const t=n(()=>l.state.user),m=n(()=>t.value.name?"你不是 "+t.value.name:"这不是你的账号");return(q,y)=>(T(),A(u(R),{title:u(m),description:"我们不能验证你的身份。"},{icon:k(()=>[x(v,{height:250,name:"Dizzy-face"})]),_:1},8,["title"]))}},P=f.api;let c=p.create({baseURL:P,timeout:1e4});c.interceptors.request.use(e=>(e.headers===void 0&&(e.headers={}),e.headers.Accept="application/json",e.headers.Authorization="Bearer "+l.state.token,r.start(),Promise.resolve(e)),e=>(console.error(e),r.error(),Promise.reject(e)));c.interceptors.response.use(e=>(e.status>=200&&e.status<300?r.finish():e.status>=400&&e.status<600&&r.error(),Promise.resolve(e)),e=>{r.error(),console.error("axios error",e);let t=[];return e.response.data.data&&(t=e.response.data.data),e.response.data.message&&(t=e.response.data.message),e.response.data.error&&(t=e.response.data.error.message),e.response.status===429?a.state.isAlertedTooManyRequests||(s.warning({title:"太频繁啦",content:"休息一会吧，服务器也累了。",positiveText:"好吧",onPositiveClick:()=>{a.state.isAlertedTooManyRequests=!1}}),a.isAlertedTooManyRequests=!0):e.response.status===401?i.currentRoute.value.name!=="auth.login"&&(a.state.isAlertedToken||(s.error({title:"访问被禁止",content:()=>o(g),positiveText:"重新登录",negativeText:"先这样",onPositiveClick:()=>{i.push({name:"auth.login"})}}),a.state.isAlertedToken=!0)):e.response.status===404?s.error({title:"404 未找到",content:()=>o(_,{show_footer:!1})}):e.response.status===500?s.error({title:"500 服务器错误",content:()=>o(h)}):t.length!==0&&s.error({title:"错误",content:t}),Promise.reject(e)});export{c as i};
