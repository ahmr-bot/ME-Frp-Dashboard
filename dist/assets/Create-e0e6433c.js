import{r as s,n as G,w as H,c as V,O as a,P as u,I as t,o as p,e as d,W as D,Y as v,Q as S,S as K,X as Q}from"./@vue-fa1c5c1f.js";import{i as k}from"./http-78f45fb6.js";import{u as R}from"./composables-b6ff6339.js";import{t as E}from"./tunnels-ebd61d86.js";import{_ as W}from"./Tunnels-a2b8bd5d.js";import{W as X,c as Y,S as P,X as j,Y as J,Z as T,_ as C,$ as O,q as L,r as M,a0 as i,n as _,j as $,J as U,k as ee,a1 as f,a2 as te,Q as re}from"./naive-ui-24262aab.js";import"./axios-c47e0cf1.js";import"./form-data-d2a9677b.js";import"./layout-4b72ee2f.js";import"./vooks-16fcc23f.js";import"./evtd-b614532e.js";import"./router-325b049e.js";import"./vue-router-c4b6792e.js";import"./user-a1f28023.js";import"./vuex-3133efbc.js";import"./500-07d896ca.js";import"./Lottie-739291b6.js";import"./lottie-web-94c7854d.js";import"./date-fns-bca8c9b2.js";import"./seemly-4f9c12c5.js";import"./vueuc-ea3f9c0c.js";import"./@css-render-43d82e32.js";import"./vdirs-b0483831.js";import"./@juggle-41516555.js";import"./css-render-d3958e6a.js";import"./@emotion-8a8e73f6.js";import"./lodash-es-cabc0acd.js";import"./treemate-25c27bff.js";import"./async-validator-dee29e8b.js";import"./404-cdb51896.js";const Be={__name:"Create",setup(ae){const c=s("create"),z=G(()=>E.state.tunnels),x=R(),r=s({name:"",protocol:"tcp",local_address:"",remote_port:"",host_id:"",id:"",server_id:"",status:"",custom_domain:""}),w=s(null),g=s([{id:1,name:"test",tunnels:0,max_tunnels:0}]),n=s({min_port:0,max_port:0}),m=s(!1);H(r.value,()=>{if(r.value.server_id){const l=g.value.find(e=>e.id===r.value.server_id);n.value.min_port=l.min_port,n.value.max_port=l.max_port}});const b=()=>{const l="allow_"+r.value.protocol;let e=g.value.filter(o=>o[l]);return e=e.filter(o=>o.tunnels<o.max_tunnels),e.map(o=>({label:o.name,value:o.id}))};k.get("/modules/frp/servers").then(l=>{g.value=l.data,r.value.server_id=b()[0].value});const I={name:[{required:!0,validator(l,e){return e?e.length>20?new Error("隧道名称不能超过 20 个字符"):!0:new Error("隧道名称是必填的")},trigger:["input","blur"]}],local_address:[{required:!0,validator(l,e){return e?/^(?:(?:\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.){3}(?:\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])(?::(?:[0-9]|[1-9][0-9]{1,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5]))?$/.test(e)?!0:new Error("本地地址只能是 IPv4:Port 格式"):new Error("需要定义本地地址")},trigger:["input","blur"]}],custom_domain:{validator(l,e){if((r.value.protocol==="http"||r.value.protocol==="https")&&!e)return new Error("需要定义自定义域名");if(!/^[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(?:\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/.test(e))return new Error("自定义域名必须是合法的域名格式")},trigger:["input","blur"]},server_id:{required:!0,message:"请选择服务器"},remote_port:{validator(l,e){if(r.value.protocol==="tcp"||r.value.protocol==="udp"){if(!e)return new Error("需要定义远程端口");if(!/^\d+$/.test(e))return new Error("远程端口必须是合法的端口格式");if(e<n.value.min_port||e>n.value.max_port)return new Error("远程端口必须在 "+n.value.min_port+" - "+n.value.max_port+" 范围内")}return!0},trigger:["input","blur"]}},B=X();function Z(l,e){return Math.floor(Math.random()*(e-l))+l}function q(){r.value.remote_port=Z(n.value.min_port,n.value.max_port).toString()}function A(){var l;(l=w.value)==null||l.validate().then(e=>{e||(m.value=!0,k.post("/modules/frp/hosts",r.value).then(o=>{E.commit("addTunnel",o.data),B.success("隧道已创建，欢迎使用 ME Frp。")}).finally(()=>{m.value=!1}))})}const F=l=>{var e,o,h,N,y;c.value="create",r.value.name=((e=l.name)==null?void 0:e.toString())+" 副本",r.value.protocol=(o=l.protocol)==null?void 0:o.toString(),r.value.local_address=(h=l.local_address)==null?void 0:h.toString(),l.remote_port&&(r.value.remote_port=(N=l.remote_port)==null?void 0:N.toString()),r.value.server_id=l.server_id,r.value.custom_domain=(y=l.custom_domain)==null?void 0:y.toString()};return(l,e)=>(p(),V("div",null,[a(t(Y),{prefix:"bar"},{default:u(()=>[a(t(P),{type:"primary"},{default:u(()=>[d(" 欢迎使用 ME Frp ")]),_:1})]),_:1}),a(t(j),null,{default:u(()=>[d("我们将引导您创建隧道。")]),_:1}),a(t(re),null,{default:u(()=>[a(t(J),{value:c.value,"onUpdate:value":e[7]||(e[7]=o=>c.value=o),animated:"",class:"card-tabs","default-value":"clone","pane-style":"padding-left: 4px; padding-right: 4px; box-sizing: border-box;",size:"large",style:{margin:"0 -4px"}},{default:u(()=>[a(t(T),{name:"create",tab:"创建"},{default:u(()=>[a(t(C),{show:m.value},{default:u(()=>[a(t(O),{ref_key:"form",ref:w,model:r.value,rules:I},{default:u(()=>[a(t(L),{cols:"1 s:2",responsive:"screen","x-gap":"12"},{default:u(()=>[a(t(M),null,{default:u(()=>[a(t(i),{label:"隧道名称",path:"name"},{default:u(()=>[a(t(_),{value:r.value.name,"onUpdate:value":e[0]||(e[0]=o=>r.value.name=o),onKeydown:e[1]||(e[1]=D(Q(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),a(t(i),{label:"本机地址",path:"local_address"},{default:u(()=>[a(t(_),{value:r.value.local_address,"onUpdate:value":e[2]||(e[2]=o=>r.value.local_address=o)},null,8,["value"])]),_:1}),r.value.protocol==="http"||r.value.protocol==="https"?(p(),v(t(i),{key:0,label:"绑定域名",path:"custom_domain"},{default:u(()=>[a(t(_),{value:r.value.custom_domain,"onUpdate:value":e[3]||(e[3]=o=>r.value.custom_domain=o),placeholder:"输入一个存在的域名"},null,8,["value"])]),_:1})):S("",!0),r.value.protocol==="tcp"||r.value.protocol==="udp"?(p(),v(t(i),{key:1,label:"远程端口",path:"remote_port"},{default:u(()=>[a(t($),null,{default:u(()=>[a(t(_),{value:r.value.remote_port,"onUpdate:value":e[4]||(e[4]=o=>r.value.remote_port=o),placeholder:"需要输入一个在 "+n.value.min_port+" 和 "+n.value.max_port+" 之间的端口"},null,8,["value","placeholder"]),a(t(U),{ghost:"",type:"primary",onClick:q},{default:u(()=>[d(K(t(x)?"随机":"随机生成"),1)]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1}),a(t(M),null,{default:u(()=>[a(t(i),{label:"传输协议"+(t(x)?"(可滑动)":""),class:"overflow-x-auto",path:"protocol"},{default:u(()=>[a(t(ee),{value:r.value.protocol,"onUpdate:value":e[5]||(e[5]=o=>r.value.protocol=o),name:"protocol"},{default:u(()=>[a(t(f),{label:"TCP",value:"tcp"}),a(t(f),{label:"UDP",value:"udp"}),a(t(f),{label:"HTTP",value:"http"}),a(t(f),{label:"HTTPS",value:"https"})]),_:1},8,["value"])]),_:1},8,["label"]),a(t(i),{label:"选择服务器",path:"server_id"},{default:u(()=>[b().length>0?(p(),v(t(te),{key:0,value:r.value.server_id,"onUpdate:value":e[6]||(e[6]=o=>r.value.server_id=o),options:b(),placeholder:"Select"},null,8,["value","options"])):(p(),v(t(P),{key:1},{default:u(()=>[d("没有可用的服务器")]),_:1}))]),_:1})]),_:1})]),_:1}),a(t(U),{block:"",secondary:"",strong:"",type:"primary",onClick:A},{default:u(()=>[d(" 新建 ")]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]),_:1}),a(t(T),{name:"clone",tab:"克隆"},{default:u(()=>[a(t(C),{show:m.value},{default:u(()=>[a(W,{next:F,tunnels:t(z)},null,8,["tunnels"])]),_:1},8,["show"])]),_:1})]),_:1},8,["value"])]),_:1})]))}};export{Be as default};
